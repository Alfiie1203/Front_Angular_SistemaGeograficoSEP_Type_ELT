<div class="page-header animate__animated animate__fadeIn">
    <div class="page-block">
        <div class="row align-items-center">
            <div class="col-md-12">
                <div class="page-header-title">
                    <h2 class="m-b-10" [innerHtml]="title_name | translate | changeTitle"></h2>
                    <!-- <button *ngIf="role && role.name=='COLABORADOR' && permissionAdd" class="btn btn-pf-primary more-btn ml-auto" routerLink="/forms/list-forms/register-forms">
                        <img src="assets/images/more.png" width="20px" class="btn-img cursor-pointer" alt="">
                    </button> -->
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row pt-4 animate__animated animate__fadeIn">
    <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12">
        <button class="btn btn-pf-primary" routerLink="/forms/validated-forms">
            <img src="assets/images/back.svg" class="btn-img" width="20px" alt="">
        </button>
        <div class="data-validated mt-4 mb-2">
            <div class="row">
                <div class="font-12 fw-bold">
                    <div class="py-3 ps-1" style="border-left: 10px solid #FF5E61; border-top-left-radius: 9px; border-bottom:0.1rem solid rgba(0, 0, 0, 0.05);;"> {{'without_checking' | translate}}</div>
                </div>

                <div class="font-12 fw-bold">
                    <div class="py-3 ps-1" style="border-left: 10px solid #4B5897; border-bottom:0.1rem solid rgba(0, 0, 0, 0.05);;">{{'in_process' | translate}}</div>
                </div>

                <div class="font-12 fw-bold">
                    <div class="py-3 ps-1" style="border-left: 10px solid #00A7B0; border-bottom-left-radius: 9px;">{{'reviewed' | translate}}</div>
                </div>
            </div>


        </div>
    </div>
    <div class="col-lg-10 col-md-10 col-sm-10 col-xs-12">
        <div class="card">
            <div class="card-body" style="border-bottom: 0 !important;">
                <div class="row">
                    <div class="col-12">
                        <h3 class="border-title">
                            {{'assigned_company' | translate}}
                        </h3>
                    </div>
                    <div class="row pt-2 animate__animated animate__fadeIn">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                            <div class="card">
                                <div class="card-body">


                                    <div class="row">
                                        <div class="col-lg-11 col-md-11 col-sm-11 col-xs-12">
                                            <div class="row container-search">
                                                <div class="box-search col-lg-4 col-md-4 col-sm-4 col-xs-4 mb-2">
                                                    <span class="p-input-icon-left w-100 w-search-list">
                                                        <i class="pi pi-search" style="color: var(--pf-blue);"></i>
                                                        <input type="text" [(ngModel)]="textSearch" (keyup)="applyFilter($event)" class="w-100" style="padding-left: 2.5rem !important; border-radius: 26px !important;" pInputText [placeholder]="'search' | translate" />
                                                    </span>
                                                </div>


                                                <div class="box-search col-lg-4 col-md-4 col-sm-4 col-xs-4 mb-2">
                                                    <span class="p-input-icon-left w-100 w-search-list">
                                          <p-dropdown id="listSubcategories" [(ngModel)]="commodity" (ngModelChange)="searchCommodity($event)"
                                            [options]="listCommodity" optionLabel="name" [filter]="true" filterBy="name"
                                            [placeholder]="'commodity' | translate" [autoDisplayFirst]="false" [showClear]="true">
                                            <ng-template pTemplate="selectedItem">
                                              <div class="country-item country-item-value" *ngIf="commodity">
                                                <div>{{ commodity.name[lang.code] }}</div>
                                              </div>
                                            </ng-template>
                                            <ng-template let-category pTemplate="item">
                                              <div class="country-item">
                                                <div>{{ category.name[lang.code] }}</div>
                                              </div>
                                            </ng-template>
                                          </p-dropdown>
                                        </span>
                                                </div>
                                                <div class="box-search col-lg-4 col-md-4 col-sm-4 col-xs-4 mb-2">
                                                    <span class="p-input-icon-left w-100 w-search-list">
                                          <p-dropdown id="listActorType" [(ngModel)]="actor_type" (ngModelChange)="searchActorType($event)"
                                            [options]="listActorType" optionLabel="name" [filter]="true" filterBy="name"
                                            [placeholder]="'type_actor' | translate" [autoDisplayFirst]="false" [showClear]="true">
                                            <ng-template pTemplate="selectedItem">
                                              <div class="country-item country-item-value" *ngIf="actor_type">
                                                <div>{{ actor_type.name[lang.code] }}</div>
                                              </div>
                                            </ng-template>
                                            <ng-template let-actor_type pTemplate="item">
                                              <div class="country-item">
                                                <div>{{ actor_type.name[lang.code] }}</div>
                                              </div>
                                            </ng-template>
                                          </p-dropdown>
                                        </span>
                                                </div>


                                                <!-- <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12 mb-2">
                                                    <button class="btn btn-pf-primary w-100  chang-clear" [lang]="lang.code" (click)="clear()" type="button">
                                          <img width="15px" class="btn-img" src="assets/images/times.png" alt="" />
                                        </button>
                                                </div> -->

                                            </div>
                                        </div>
                                        <div class="col-lg-1 col-md-1 col-sm-1 col-xs-12 d-flex align-items-center mt-2">
                                            <button class="btn btn-pf-primary w-100  chang-clear" [lang]="lang.code" (click)="clear()" type="button">
                                                <img width="15px" class="btn-img" src="assets/images/times.png" alt="" />
                                              </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="example-container position-relative">
                                    <app-load-table></app-load-table>
                                    <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows class="table-list-business">

                                        <ng-container matColumnDef="completed">
                                            <th mat-header-cell *matHeaderCellDef width="15%"> {{'completed' | translate}} </th>
                                            <td mat-cell *matCellDef="let element" [ngStyle]="{'border-left': setPorcent(subRol.name=='VERIFICADOR'?element.percentage_verified:subRol.name=='VALIDADOR'?element.percentage_validated:'', element)}" (click)="checked(element)">
                                                <div class="porcent-form py-1 me-2">
                                                    <div id="middle-circle">
                                                        <ng-container *ngIf="subRol.name=='VERIFICADOR'">
                                                            {{element.percentage_verified}}%
                                                        </ng-container>
                                                        <ng-container *ngIf="subRol.name=='VALIDADOR'">
                                                            {{element.percentage_validated}}%
                                                        </ng-container>
                                                    </div>
                                                    <ng-container *ngIf="subRol.name=='VERIFICADOR'">
                                                        <div id="progress-spinner" [ngStyle]="{'background':'conic-gradient(var(--pf-blue)'+element.percentage_verified+'%,rgb(242, 242, 242) '+element.percentage_verified+'%)'}"></div>
                                                    </ng-container>
                                                    <ng-container *ngIf="subRol.name=='VALIDADOR'">
                                                        <div id="progress-spinner" [ngStyle]="{'background':'conic-gradient(var(--pf-blue)'+element.percentage_validated+'%,rgb(242, 242, 242) '+element.percentage_validated+'%)'}"></div>
                                                    </ng-container>
                                                </div>

                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="name">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header width="45%"> {{'name' | translate}} </th>
                                            <td mat-cell *matCellDef="let element" (click)="checked(element)">
                                                <span class="d-block">
                                                    {{element.assigned_company.name}}
                                                </span>
                                                <span class="d-block font-12 text-pf-secondary">
                                                    {{element.assigned_company.commodity.name[lang.code] | translate}}
                                                </span>
                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="type_actor">
                                            <th mat-header-cell *matHeaderCellDef width="25%"> {{'type_actor' | translate}} </th>
                                            <td mat-cell *matCellDef="let element" (click)="checked(element)">
                                                {{element.assigned_company.actor_type.name[lang.code] }}
                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="assing">
                                            <th mat-header-cell *matHeaderCellDef class="text-center" width="15%"> {{'action' | translate}} </th>
                                            <td mat-cell class="text-center" *matCellDef="let element">
                                                <button class="btn btn-pf-primary export-btn" (click)="review(element.id)">
                                                    <ng-container *ngIf="element.revision_status != 'VERIFIED' && element.revision_status != 'VALIDATE'; else re">
                                                        {{'Revisar' | translate}}
                                                    </ng-container>
                                                    <ng-template #re>
                                                        {{'view' | translate}}
                                                    </ng-template>
                                                    
                                                </button>
                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="more">
                                            <th mat-header-cell *matHeaderCellDef width="1%" class="text-center">
                                                {{ "more" | translate }}
                                            </th>
                                            <td mat-cell *matCellDef="let element" class="text-center">
                                                <button class="btn border-none" style="margin-top: 5px" (click)="expand(element)">
    <i class="pi pi-chevron-down"></i>
  </button>
                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="expandedDetail">
                                            <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
                                                <div class="example-element-detail" [@detailExpand]="
      element == expandedElement ? 'expanded' : 'collapsed'
    ">
                                                    <div class="py-3 w-75 d-block mx-auto more-business">
                                                        <div class="row">

                                                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                                                <div class="field">
                                                                    <label class="d-block">{{ "type_actor" | translate }}</label>
                                                                    <input type="text" class="w-100" pInputText readonly value="{{ element.assigned_company.actor_type.name[lang.code] }}" />
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </td>
                                        </ng-container>


                                        <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
                                        <tr mat-row *matRowDef="let row; columns: columnsToDisplay;" class="example-element-row" [class.example-expanded-row]="expandedElement === row" [ngClass]="{'highlight': selectedRowIndex ==row.id}">
                                        </tr>
                                        <tr mat-row *matRowDef="let element; columns: ['expandedDetail']" class="example-detail-row"></tr>
                                        <tr class="mat-row" *matNoDataRow>
                                            <td class="mat-cell" *ngIf="filterValue!=''; else noData" colspan="4">{{'no_found' | translate}} "{{filterValue}}"</td>
                                            <ng-template #noData>
                                                <td class="mat-cell" colspan="4">{{'no_records' | translate}}</td>
                                            </ng-template>

                                        </tr>
                                    </table>
                                </div>

                                <mat-paginator (page)="paginationChangeSize($event)" [length]="listSize" [pageSizeOptions]="[10, 25, 50, 100]"></mat-paginator>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>