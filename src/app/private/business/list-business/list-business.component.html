<div class="page-header animate__animated animate__fadeIn">
    <div class="page-block">
        <div class="row align-items-center">
            <div class="col-md-12">
                <div class="page-header-title">
                    <h2 class="m-b-10" [innerHtml]="'business_list' | translate | changeTitle"></h2>
                    <!-- <button *ngIf="permissionAdd" class="btn btn-pf-primary more-btn ml-auto" routerLink="/business/create-edit-business"> -->
                    <!-- <img src="assets/images/more.png" width="20px" class="btn-img cursor-pointer" alt=""> -->
                    <!-- </button> -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- </div> -->
<!-- </div> -->
<div class="row pt-4 animate__animated animate__fadeIn">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
            <div class="card-body">
                <!-- <span class="p-input-icon-left w-75 w-search-list">
                    <i class="pi pi-search" style="color: var(--pf-blue);"></i>
                    <input type="text" [(ngModel)]="textSearch" (keyup)="applyFilter($event)" class="w-100" style="padding-left: 2.5rem !important; border-radius: 26px !important;" pInputText [placeholder]="'search' | translate" />
                </span> -->
                <span class="w-search-list">
          <div class="row d-flex align-items-center">
            <div class="col-lg-5 col-md-5 col-sm-5 col-xs-12 mb-2">
              <span class="p-input-icon-left w-100">
                <i class="pi pi-search" style="color: var(--pf-blue)"></i>
                <input
                  type="text"
                  [(ngModel)]="textSearch"
                  (keyup)="applyFilter($event)"
                  class="w-100"
                  style="
                    padding-left: 2.5rem !important;
                    border-radius: 26px !important;
                  "
                  pInputText
                  [placeholder]="'search' | translate"
                />
              </span>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12 mb-2">
                <div>
                    <!-- <div class="d-flex title-input">
                                    <label class="d-block truncate-text"> {{'subcategory' | translate}}</label>
                                </div> -->
                    <p-dropdown id="listSubcategories" [(ngModel)]="commodity" (ngModelChange)="searchCommodity($event)" [options]="listCommodity" optionLabel="name" [filter]="true" filterBy="name" [placeholder]="'commodity' | translate" [autoDisplayFirst]="false" [showClear]="true">
                        <ng-template pTemplate="selectedItem">
                            <div class="country-item country-item-value" *ngIf="commodity">
                                <div>{{ commodity.name[lang.code] }}</div>
                            </div>
                        </ng-template>
                        <ng-template let-category pTemplate="item">
                            <div class="country-item">
                                <div>{{ category.name[lang.code] }}</div>
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12 mb-2">
                <div>
                    <!-- <div class="d-flex title-input">
                        <label class="d-block truncate-text"> {{'category' | translate}}</label>
                    </div> -->
                    <p-dropdown id="listActorType" [(ngModel)]="actor_type" (ngModelChange)="searchActorType($event)" [options]="listActorType" optionLabel="name" [filter]="true" filterBy="name" [placeholder]="'type_actor' | translate" [autoDisplayFirst]="false" [showClear]="true">
                        <ng-template pTemplate="selectedItem">
                            <div class="country-item country-item-value" *ngIf="actor_type">
                                <div>{{ actor_type.name[lang.code] }}</div>
                            </div>
                        </ng-template>
                        <ng-template let-actor_type pTemplate="item">
                            <div class="country-item">
                                <div>{{ actor_type.name[lang.code] }}</div>
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>
            </div>

            <div class="col-lg-1 col-md-1 col-sm-1 col-xs-12 mb-2">
                <button class="btn btn-pf-primary w-100  chang-clear" [lang]="lang.code" (click)="clear()" type="button">
                <img
                  width="15px"
                  class="btn-img"
                  src="assets/images/times.png"
                  alt=""
                />
              </button>
            </div>
        </div>
        </span>
    </div>
    <div class="example-container position-relative">
        <app-load-table></app-load-table>
        <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows class="table-list-business">
            <ng-container matColumnDef="select">
                <th mat-header-cell *matHeaderCellDef width="10%" class="text-center">
                    <!-- <mat-checkbox (change)="$event ? masterToggle() : null"
                                            [checked]="selection.hasValue() && isAllSelected()"
                                            [indeterminate]="selection.hasValue() && !isAllSelected()"
                                            [aria-label]="checkboxLabel()"
                                            >
                            </mat-checkbox> -->
                </th>
                <td mat-cell *matCellDef="let row" class="text-center">
                    <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                    </mat-checkbox>
                </td>
            </ng-container>

            <!-- <ng-container matColumnDef="id">
                        <th mat-header-cell *matHeaderCellDef width="20%"> {{'id' | translate}} </th>
                        <td mat-cell *matCellDef="let element" (click)="checked(element)"> {{element.identifier_proforest_company}}</td>
                    </ng-container> -->

            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header width="40%">
                    {{ "business" | translate }}
                </th>
                <td mat-cell *matCellDef="let element" (click)="checked(element)">
                    <span class="d-block">
                {{ element.name }}
              </span>
                    <span class="d-block font-12 text-pf-secondary">
                {{ element.commodity.name[lang.code] }}
              </span>
                </td>
            </ng-container>
            <ng-container matColumnDef="type_actor">
                <th mat-header-cell *matHeaderCellDef width="25%">
                    {{ "type_actor" | translate }}
                </th>
                <td mat-cell *matCellDef="let element" (click)="checked(element)">
                    {{ element.actor_type.name[lang.code] }}
                </td>
            </ng-container>

            <ng-container matColumnDef="switch">
                <th mat-header-cell *matHeaderCellDef width="10%"></th>
                <td mat-cell *matCellDef="let element">
                    <div class="form-check form-switch">
                        <span class="d-block truncate-business" [ngClass]="element.status?'text-success':'text-danger'">
                            <ng-container *ngIf="element.status; else noActive">
                                {{'active' | translate}}
                            </ng-container>
                            <ng-template #noActive>
                                {{'inactive' | translate}}
                            </ng-template>
                            
                        </span>
                        <!-- <input class="form-check-input" disabled="true" [(ngModel)]="element.status" onclick="return false" type="checkbox" role="switch" id="flexSwitchCheckDefault"> -->
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef width="15%" class="text-center">
                    {{ "action" | translate }}
                </th>
                <td mat-cell *matCellDef="let element" class="text-center">
                    <button class="btn border-none" style="margin-top: 5px" [matMenuTriggerFor]="menu">
                <i class="pi pi-ellipsis-v"></i>
              </button>
                    <mat-menu #menu="matMenu">
                        <button (click)="expand(element)" class="view-more" mat-menu-item>
                  <i
                    class="icon-option pi pi-eye"
                    style="vertical-align: middle"
                  ></i>
                  <span *ngIf="expandedElement == null">{{
                    "view_more" | translate
                  }}</span>
                  <span
                    *ngIf="
                      expandedElement != null &&
                      expandedElement.id == element.id
                    "
                    >{{ "hide" | translate }}</span
                  >
                  <span
                    *ngIf="
                      expandedElement != null &&
                      expandedElement.id != element.id
                    "
                    >{{ "view_more" | translate }}</span
                  >
                </button>
                        <button *ngIf="permissionChange" (click)="edit(element)" mat-menu-item>
                  <img
                    src="assets/images/edit.png"
                    class="icon-option"
                    alt=""
                  />
                  <span>{{ "edit" | translate }}</span>
                </button>
                        <!-- <button *ngIf="permissionDelete" (click)="showDelete(element)" mat-menu-item class="text-danger">
                  <img
                    src="assets/images/delete.png"
                    class="icon-option"
                    alt=""
                  />
                  <span>{{ "delete" | translate }}</span>
                </button> -->
                    </mat-menu>
                </td>
            </ng-container>

            <ng-container matColumnDef="more">
                <th mat-header-cell *matHeaderCellDef width="1%" class="text-center">
                    {{ "more" | translate }}
                </th>
                <td mat-cell *matCellDef="let element" class="text-center">
                    <button class="btn border-none" style="margin-top: 5px" (click)="expand(element)">
                <i class="pi pi-chevron-down"></i>
              </button>
                </td>
            </ng-container>

            <ng-container matColumnDef="expandedDetail">
                <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
                    <div class="example-element-detail" [@detailExpand]="
                  element == expandedElement ? 'expanded' : 'collapsed'
                ">
                        <div class="py-3 w-75 d-block mx-auto more-business">
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <div class="field">
                                        <label class="d-block">{{ "nit" | translate }}</label>
                                        <input type="text" class="w-100" pInputText readonly value="{{ element.nit }}" />
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <div class="field">
                                        <label class="d-block">{{
                          "business_group" | translate
                        }}</label>
                                        <input type="text" class="w-100" pInputText readonly value="{{
                            element.company_group != null
                              ? element.company_group.name
                              : ('no_description' | translate)
                          }}" />
                                    </div>
                                </div>
                                <div class="col-xs-12 table-actor-type">
                                    <div class="field">
                                        <label class="d-block">{{
                          "type_actor" | translate
                        }}</label>
                                        <input type="text" class="w-100" pInputText readonly value="{{ element.actor_type.name[lang.code] }}" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <div class="field">
                                        <label class="d-block">{{
                          "id_global_business" | translate
                        }}</label>
                                        <input type="text" class="w-100" pInputText readonly value="{{ element.identifier_global_company }}" />
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <div class="field">
                                        <label class="d-block">{{
                          "id_proforest_business" | translate
                        }}</label>
                                        <input type="text" class="w-100" pInputText readonly value="{{ element.identifier_proforest_company }}" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <div class="field">
                                        <label class="d-block">{{
                          "country" | translate
                        }}</label>
                                        <input type="text" class="w-100" pInputText readonly value="{{ element.country?element.country.name:('no_description' | translate) }}" />
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <div class="field">
                                        <label class="d-block">{{ "state" | translate }}</label>
                                        <input type="text" class="w-100" pInputText readonly value="{{ element.region?element.region.name:('no_description' | translate) }}" />
                                    </div>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                    <div class="field">
                                        <label class="d-block">{{
                          "municipality" | translate
                        }}</label>
                                        <input type="text" class="w-100" pInputText readonly value="{{ element.city?element.city.name:('no_description' | translate) }}" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: columnsToDisplay" class="example-element-row" [class.example-expanded-row]="expandedElement === row" [ngClass]="{ highlight: selectedRowIndex == row.id }"></tr>
            <tr mat-row *matRowDef="let element; columns: ['expandedDetail']" class="example-detail-row"></tr>
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" *ngIf="filterValue != ''; else noData" colspan="4">
                    {{ "no_found" | translate }} "{{ filterValue }}"
                </td>
                <ng-template #noData>
                    <td class="mat-cell" colspan="4">
                        {{ "no_records" | translate }}
                    </td>
                </ng-template>
            </tr>
        </table>
    </div>

    <mat-paginator (page)="paginationChangeSize($event)" [length]="listSize" [pageSizeOptions]="[10, 25, 50, 100]"></mat-paginator>
</div>
</div>
</div>

<p-dialog *ngIf="enterprise != undefined" [(visible)]="display" [modal]="true" [breakpoints]="{ '960px': '75vw' }" [style]="{ width: '40vw' }" [draggable]="false" [resizable]="false" styleClass="dialog-delete">
    <div class="row">
        <div class="col-12">
            <h5 class="text-center">
                <b> {{ "description_delete" | translate }} </b>
            </h5>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <div class="field">
                <label for="email" class="d-block">{{
          "enterprise" | translate
        }}</label>
                <input id="email" [(ngModel)]="enterprise.name" class="w-100" type="text" readonly pInputText />
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <div class="field">
                <label for="email" class="d-block">{{
          "id_business" | translate
        }}</label>
                <input id="email" [(ngModel)]="enterprise.identifier_proforest_company" class="w-100" type="text" readonly pInputText />
            </div>
        </div>
        <div class="col-6">
            <button class="btn btn-cancel w-100" (click)="display = false">
        {{ "cancel" | translate }}
      </button>
        </div>
        <div class="col-6">
            <ng-container *ngIf="!loading; else load">
                <button class="btn btn-outline-danger w-100" (click)="delete()">
          {{ "delete" | translate }}
        </button>
            </ng-container>
            <ng-template #load>
                <span class="spinner-grow text-pf-primary d-block mx-auto" tyle="width: 1.5rem; height: 1.5rem;"></span>
            </ng-template>
        </div>
    </div>
</p-dialog>

<p-dialog [(visible)]="displayConfirm" [modal]="true" [breakpoints]="{ '960px': '75vw' }" [style]="{ width: '35vw' }" [draggable]="false" [resizable]="false" styleClass="dialog-delete">
    <div class="row text-center">
        <div class="col-12">
            <h3 class="text-center">
                <b> {{ "delete_success" | translate }} </b>
            </h3>
            <p>{{ "description_delete_success" | translate }}</p>
        </div>
        <div class="col-12">
            <img src="assets/images/check.png" class="mx-auto d-block" alt="" />
        </div>
        <div class="col-12 pt-4">
            <button class="btn btn-pf-primary p-btn" (click)="displayConfirm = false">
        {{ "accept" | translate }}
      </button>
        </div>
    </div>
</p-dialog>