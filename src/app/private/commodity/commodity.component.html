<div class="page-header animate__animated animate__fadeIn">
    <div class="page-block">
        <div class="row align-items-center">
            <div class="col-md-12">
                <div class="page-header-title">
                    <h2 class="m-b-10" [innerHtml]="'commodity' | translate | changeTitle"></h2>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row pt-4 animate__animated animate__fadeIn">
    <div class="col-sm-12">
        <div class="card">
            <div class="card-body">
                <div *ngIf="permissionAdd" class="row">
                    <div class="col-12">
                        <h3 class="border-title">
                            {{'register_commodity' | translate}}
                        </h3>
                    </div>
                </div>
                <form *ngIf="permissionAdd" autocomplete="off" autocapitalize="off" (ngSubmit)="register()" [formGroup]="form">
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                            <div class="field">
                                <div class="d-flex title-input">
                                    <label class="d-block truncate-text"> {{'commodity_name' | translate}} ({{'english' | translate}})</label> <span class="text-danger">*</span>
                                </div>
                                <input id="commodity_name_en" formControlName="name_en" class="w-100" type="text" [placeholder]="'commodity_name' | translate" [ngClass]="{'ng-invalid ng-dirty': f['name_en'].invalid && f['name_en'].touched}" (click)="op.toggle($event)" (keyup)="suggestions($event)"
                                    pInputText/>
                                <div *ngIf="f['name_en'].invalid && f['name_en'].touched && f['name_en'].errors!=null" class="text-danger ps-2 pt-1 font-12">
                                    <small id="password-help" *ngIf="f['name_en'].errors['required']" class="block">{{'required_field' | translate}}</small>
                                </div>
                                <p-overlayPanel #op [dismissable]="true" [showCloseIcon]="false">
                                    <ng-template pTemplate>
                                        <ul *ngIf="!loadSuggestion; else lS" class="pl-2 ml-2 mt-0 font-13" style="line-height: 1.5">
                                            <ng-container *ngIf="listSuggestion.length; else listS">
                                                <li *ngFor="let item of listSuggestion">{{item}}</li>
                                            </ng-container>
                                            <ng-template #listS>
                                                {{'no_records' | translate}}
                                            </ng-template>


                                        </ul>
                                        <ng-template #lS>
                                            <ul class="pl-2 ml-2 mt-0 font-13" style="line-height: 1.5">
                                                <p-skeleton *ngFor="let item of [1,1,1,1,1,1]" styleClass="mb-1" width="200px"></p-skeleton>
                                            </ul>
                                        </ng-template>
                                    </ng-template>
                                </p-overlayPanel>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                            <div class="field">
                                <div class="d-flex title-input">
                                    <label class="d-block truncate-text"> {{'commodity_name' | translate}} ({{'spanish' | translate}})</label> <span class="text-danger">*</span>
                                </div>
                                <input id="commodity_name_es" formControlName="name_es" class="w-100" type="text" [placeholder]="'commodity_name' | translate" [ngClass]="{'ng-invalid ng-dirty': f['name_es'].invalid && f['name_es'].touched}" (click)="op.toggle($event)" (keyup)="suggestions($event)"
                                    pInputText/>
                                <div *ngIf="f['name_es'].invalid && f['name_es'].touched && f['name_es'].errors!=null" class="text-danger ps-2 pt-1 font-12">
                                    <small id="password-help" *ngIf="f['name_es'].errors['required']" class="block">{{'required_field' | translate}}</small>
                                </div>
                                <p-overlayPanel #op [dismissable]="true" [showCloseIcon]="false">
                                    <ng-template pTemplate>
                                        <ul *ngIf="!loadSuggestion; else lS" class="pl-2 ml-2 mt-0 font-13" style="line-height: 1.5">
                                            <ng-container *ngIf="listSuggestion.length; else listS">
                                                <li *ngFor="let item of listSuggestion">{{item}}</li>
                                            </ng-container>
                                            <ng-template #listS>
                                                {{'no_records' | translate}}
                                            </ng-template>


                                        </ul>
                                        <ng-template #lS>
                                            <ul class="pl-2 ml-2 mt-0 font-13" style="line-height: 1.5">
                                                <p-skeleton *ngFor="let item of [1,1,1,1,1,1]" styleClass="mb-1" width="200px"></p-skeleton>
                                            </ul>
                                        </ng-template>
                                    </ng-template>
                                </p-overlayPanel>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                            <div class="field">
                                <div class="d-flex title-input">
                                    <label class="d-block truncate-text"> {{'commodity_name' | translate}} ({{'portuguese' | translate}})</label> <span class="text-danger">*</span>
                                </div>
                                <input id="commodity_name_pt" formControlName="name_pt" class="w-100" type="text" [placeholder]="'commodity_name' | translate" [ngClass]="{'ng-invalid ng-dirty': f['name_pt'].invalid && f['name_pt'].touched}" (click)="op.toggle($event)" (keyup)="suggestions($event)"
                                    pInputText/>
                                <div *ngIf="f['name_pt'].invalid && f['name_pt'].touched && f['name_pt'].errors!=null" class="text-danger ps-2 pt-1 font-12">
                                    <small id="password-help" *ngIf="f['name_pt'].errors['required']" class="block">{{'required_field' | translate}}</small>
                                </div>
                                <p-overlayPanel #op [dismissable]="true" [showCloseIcon]="false">
                                    <ng-template pTemplate>
                                        <ul *ngIf="!loadSuggestion; else lS" class="pl-2 ml-2 mt-0 font-13" style="line-height: 1.5">
                                            <ng-container *ngIf="listSuggestion.length; else listS">
                                                <li *ngFor="let item of listSuggestion">{{item}}</li>
                                            </ng-container>
                                            <ng-template #listS>
                                                {{'no_records' | translate}}
                                            </ng-template>


                                        </ul>
                                        <ng-template #lS>
                                            <ul class="pl-2 ml-2 mt-0 font-13" style="line-height: 1.5">
                                                <p-skeleton *ngFor="let item of [1,1,1,1,1,1]" styleClass="mb-1" width="200px"></p-skeleton>
                                            </ul>
                                        </ng-template>
                                    </ng-template>
                                </p-overlayPanel>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                            <div class="field">
                                <div class="d-flex title-input">
                                    <label class="d-block truncate-text"> {{'commodity_code_proforest' | translate}}</label> <span class="text-danger">*</span>
                                </div>
                                <input id="proforest_commodity_code" formControlName="proforest_commodity_code" (keyup)="form.get('proforest_commodity_code')?.setValue(form.get('proforest_commodity_code')?.value.toUpperCase())" class="w-100" type="text" [placeholder]="'commodity_code_proforest' | translate"
                                    [ngClass]="{'ng-invalid ng-dirty': f['proforest_commodity_code'].invalid && f['proforest_commodity_code'].touched}" pInputText/>
                                <div *ngIf="f['proforest_commodity_code'].invalid && f['proforest_commodity_code'].touched && f['proforest_commodity_code'].errors!=null" class="text-danger ps-2 pt-1 font-12">
                                    <small id="password-help" *ngIf="f['proforest_commodity_code'].errors['required']" class="block">{{'required_field' | translate}}</small>
                                    <small id="password-help" *ngIf="f['proforest_commodity_code'].errors['maxlength']" class="block">{{'max_value_field' | translate:{length: '2'} }}</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-1 col-md-1 col-sm-6 col-xs-12">
                            <div class="field">
                                <label class="d-block">{{'state' | translate}}</label>
                                <div class="form-check form-switch" style="width: max-content;">
                                    <input class="form-check-input" formControlName="status" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
                            <div class="field">
                                <label class="d-block">&nbsp;</label>
                                <ng-container *ngIf="!loading; else load">
                                    <button class="btn btn-pf-primary w-100" type="submit">
                                        <img src="assets/images/save.png" class="me-2 btn-img" width="20px" alt=""> {{'register' | translate}}
                                    </button>
                                </ng-container>
                                <ng-template #load>
                                    <span class="spinner-grow text-pf-primary d-block mx-auto" tyle="width: 1.5rem; height: 1.5rem;"></span>
                                </ng-template>
                            </div>
                        </div>
                    </div>
                </form>

                <div class="row">
                    <div class="col-12">
                        <h3 class="border-title">
                            {{'list_commodity' | translate}}
                        </h3>
                    </div>
                    <div class="col-12">

                        <div class="card">
                            <div class="card-body card-body-list">
                                <span class="p-input-icon-left w-75 w-search-list">
                                    <i class="pi pi-search" style="color: var(--pf-blue);"></i>
                                    <input type="text" (keyup)="applyFilter($event)" class="w-100" style="padding-left: 2.5rem !important; border-radius: 26px !important;" pInputText [placeholder]="'search' | translate" />
                                </span>
                            </div>

                            <div class="example-container position-relative">
                                <app-load-table></app-load-table>
                                <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows class="table-list-business">


                                    <ng-container matColumnDef="name">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header width="40%"> {{'commodity_name' | translate}} </th>
                                        <td mat-cell *matCellDef="let element" (click)="checked(element)"> {{element.name[lang.code]}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="proforest_commodity_code">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header width="35%"> {{'commodity_code_proforest' | translate}} </th>
                                        <td mat-cell *matCellDef="let element" (click)="checked(element)"> {{element.proforest_commodity_code}} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="state">
                                        <th mat-header-cell *matHeaderCellDef width="10%"> {{'state' | translate}} </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{(element.status)?statusActive:statusInactive}}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="actions">
                                        <th [ngClass]="permissionChange || permissionDelete ? '' : 'd-none' " mat-header-cell *matHeaderCellDef width="5%" class="text-center"> {{'action' | translate}} </th>
                                        <td [ngClass]="permissionChange || permissionDelete ? '' : 'd-none' " mat-cell *matCellDef="let element" class="text-center">
                                            <button class="btn border-none" style="margin-top: 5px;" [matMenuTriggerFor]="menu">
                                                <i class="pi pi-ellipsis-v"></i>
                                            </button>
                                            <mat-menu #menu="matMenu">
                                                <button *ngIf="permissionChange" (click)="edit(element)" mat-menu-item>
                                                <img src="assets/images/edit.png" class="icon-option" alt="">
                                                <span>{{'edit' | translate}}</span>
                                                </button>
                                                <button *ngIf="permissionDelete" (click)="showDelete(element)" mat-menu-item class="text-danger">
                                                <img src="assets/images/delete.png" class="icon-option" alt="">
                                                <span>{{'delete' | translate}}</span>
                                                </button>
                                            </mat-menu>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="more">
                                        <th mat-header-cell *matHeaderCellDef width="1%" class="text-center"> {{'more' | translate}} </th>
                                        <td mat-cell *matCellDef="let element" class="text-center">
                                            <button class="btn border-none" style="margin-top: 5px;" (click)="expand(element)">
                                                <i class="pi pi-chevron-down"></i>
                                            </button>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="expandedDetail">
                                        <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
                                            <div class="example-element-detail" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                                                <div class="py-3 w-75 d-block mx-auto more-business">
                                                    <div class="row">
                                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                                            <div class="field">
                                                                <label class="d-block">{{ "commodity_code_proforest"| translate }}</label>
                                                                <input type="text" class="w-100" pInputText readonly value="{{ element.proforest_commodity_code}}" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </ng-container>


                                    <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
                                    <tr mat-row *matRowDef="let row; columns: columnsToDisplay;" class="example-element-row" [class.example-expanded-row]="expandedElement === row" [ngClass]="{'highlight': selectedRowIndex ==row.id}">
                                    </tr>
                                    <tr mat-row *matRowDef="let element; columns: ['expandedDetail']" class="example-detail-row"></tr>
                                    <tr class="mat-row" *matNoDataRow>
                                        <td class="mat-cell" *ngIf="filterValue!=''; else noData" colspan="4">{{'no_found' | translate}} "{{filterValue}}"</td>
                                        <ng-template #noData>
                                            <td class="mat-cell" colspan="4">{{'no_records' | translate}}</td>
                                        </ng-template>

                                    </tr>
                                </table>
                            </div>

                            <mat-paginator (page)="paginationChangeSize($event)" [length]="listSize" [pageSizeOptions]="[5, 10, 25, 50]"></mat-paginator>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<p-dialog *ngIf="commodity!=undefined" [(visible)]="display" [modal]="true" [breakpoints]="{'960px': '90vw'}" [style]="{width: '40vw'}" [draggable]="false" [resizable]="false" styleClass="dialog-delete">
    <div class="row">
        <div class="col-12">
            <h5 class="text-center"><b> {{'description_delete' | translate}} </b></h5>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <div class="field">
                <label for="email" class="d-block">{{'commodity_name' | translate}}</label>
                <input id="email" [(ngModel)]="commodity.name[lang.code]" class="w-100" type="text" readonly pInputText/>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <div class="field">
                <label for="email" class="d-block">{{'commodity_code_proforest' | translate}}</label>
                <input id="email" [(ngModel)]="commodity.proforest_commodity_code" class="w-100" type="text" readonly pInputText/>
            </div>
        </div>
        <div class="col-6">
            <button class="btn btn-cancel w-100" (click)="closeDelete()"> {{'cancel' | translate}} </button>
        </div>
        <div class="col-6">
            <ng-container *ngIf="!loading; else load">
                <button class="btn btn-outline-danger w-100" (click)="delete()"> {{'delete' | translate}} </button>
            </ng-container>
            <ng-template #load>
                <span class="spinner-grow text-pf-primary d-block mx-auto" tyle="width: 1.5rem; height: 1.5rem;"></span>
            </ng-template>
        </div>
    </div>

</p-dialog>

<p-dialog [(visible)]="displayConfirm" [modal]="true" [breakpoints]="{'960px': '75vw'}" [style]="{width: '35vw'}" [draggable]="false" [resizable]="false" styleClass="dialog-delete">
    <div class="row text-center">
        <div class="col-12">
            <h3 class="text-center"><b> {{'delete_success' | translate}} </b></h3>
            <p>{{'description_delete_success' | translate}}</p>
        </div>
        <div class="col-12">
            <img src="assets/images/check.png" class="mx-auto d-block" alt="">
        </div>
        <div class="col-12 pt-4">
            <button class="btn btn-pf-primary p-btn" (click)="displayConfirm=false"> {{'accept' | translate}} </button>
        </div>
    </div>

</p-dialog>

<p-dialog [(visible)]="display2" [modal]="true" [breakpoints]="{'960px': '95vw'}" [style]="{width: '40vw'}" [draggable]="false" [resizable]="false" styleClass="dialog-delete">
    <div class="row">
        <div class="col-12">
            <h3 class="text-center"><b> {{'update' | translate}} {{'commodity' | translate}}</b></h3>
        </div>
    </div>
    <form autocapitalize="off" (ngSubmit)="update()" [formGroup]="formUpdate">
        <input type="text" style="display: none;" formControlName="id">
        <div class="row">
            <div class="col-10">
                <div class="field">
                    <label class="d-block">{{'commodity_name' | translate}} ({{'english' | translate}})<span class="text-danger">*</span></label>
                    <input id="commodity_name_en" formControlName="name_en" class="w-100" type="text" [placeholder]="'commodity_name' | translate" [ngClass]="{'ng-invalid ng-dirty': fU['name_en'].invalid && fU['name_en'].touched}" pInputText/>
                    <div *ngIf="fU['name_en'].invalid && fU['name_en'].touched && fU['name_en'].errors!=null" class="text-danger ps-2 pt-1 font-12">
                        <small id="password-help" *ngIf="fU['name_en'].errors['required']" class="block">{{'required_field' | translate}}</small>
                    </div>
                </div>
            </div>
            <div class="col-10">
                <div class="field">
                    <label class="d-block">{{'commodity_name' | translate}} ({{'spanish' | translate}})<span class="text-danger">*</span></label>
                    <input id="commodity_name_es" formControlName="name_es" class="w-100" type="text" [placeholder]="'commodity_name' | translate" [ngClass]="{'ng-invalid ng-dirty': fU['name_es'].invalid && fU['name_es'].touched}" pInputText/>
                    <div *ngIf="fU['name_es'].invalid && fU['name_es'].touched && fU['name_es'].errors!=null" class="text-danger ps-2 pt-1 font-12">
                        <small id="password-help" *ngIf="fU['name_es'].errors['required']" class="block">{{'required_field' | translate}}</small>
                    </div>
                </div>
            </div>
            <div class="col-10">
                <div class="field">
                    <label class="d-block">{{'commodity_name' | translate}} ({{'portuguese' | translate}})<span class="text-danger">*</span></label>
                    <input id="commodity_name_pt" formControlName="name_pt" class="w-100" type="text" [placeholder]="'commodity_name' | translate" [ngClass]="{'ng-invalid ng-dirty': fU['name_pt'].invalid && fU['name_pt'].touched}" pInputText/>
                    <div *ngIf="fU['name_pt'].invalid && fU['name_pt'].touched && fU['name_pt'].errors!=null" class="text-danger ps-2 pt-1 font-12">
                        <small id="password-help" *ngIf="fU['name_pt'].errors['required']" class="block">{{'required_field' | translate}}</small>
                    </div>
                </div>
            </div>
            <div class="col-10">
                <div class="field">
                    <label class="d-block">{{'commodity_code_proforest' | translate}} <span class="text-danger">*</span></label>
                    <input id="proforest_commodity_code" (keyup)="formUpdate.get('proforest_commodity_code')?.setValue(formUpdate.get('proforest_commodity_code')?.value.toUpperCase())" formControlName="proforest_commodity_code" class="w-100" type="text" [placeholder]="'commodity_code_proforest' | translate"
                        [ngClass]="{'ng-invalid ng-dirty': fU['proforest_commodity_code'].invalid && fU['proforest_commodity_code'].touched}" pInputText/>
                    <div *ngIf="fU['proforest_commodity_code'].invalid && fU['proforest_commodity_code'].touched && fU['proforest_commodity_code'].errors!=null" class="text-danger ps-2 pt-1 font-12">
                        <small id="password-help" *ngIf="fU['proforest_commodity_code'].errors['required']" class="block">{{'required_field' | translate}}</small>
                        <small id="password-help" *ngIf="fU['proforest_commodity_code'].errors['maxlength']" class="block">{{'max_value_field' | translate:{length: '2'} }}</small>
                    </div>
                </div>
            </div>
            <div class="col-2 text-center">
                <div class="field">
                    <label class="d-block">{{'state' | translate}}</label>
                    <div class="form-check form-switch mx-auto" style="width: max-content;">
                        <input class="form-check-input me-0" formControlName="status" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                    </div>
                </div>
            </div>
            <div class="col-6">
                <button class="btn btn-cancel w-100" (click)="closeDelete()"> {{'cancel' | translate}} </button>
            </div>
            <div class="col-6">
                <ng-container *ngIf="!loading; else load">
                    <button class="btn btn-pf-primary w-100 h-100" type="submit"> {{'update' | translate}} </button>
                </ng-container>
                <ng-template #load>
                    <span class="spinner-grow text-pf-primary d-block mx-auto" tyle="width: 1.5rem; height: 1.5rem;"></span>
                </ng-template>
            </div>
        </div>
    </form>

</p-dialog>

<p-dialog [(visible)]="displayUpdate" [modal]="true" [breakpoints]="{'960px': '75vw'}" [style]="{width: '35vw'}" [draggable]="false" [resizable]="false" styleClass="dialog-delete">
    <div class="row text-center">
        <div class="col-12">
            <h3 class="text-center"><b> {{'update_success' | translate}} </b></h3>
            <p>{{'description_update_success' | translate}}</p>
        </div>
        <div class="col-12">
            <img src="assets/images/check.png" class="mx-auto d-block" alt="">
        </div>
        <div class="col-12 pt-4">
            <button class="btn btn-pf-primary p-btn" (click)="displayUpdate=false"> {{'accept' | translate}} </button>
        </div>
    </div>

</p-dialog>

<p-dialog [(visible)]="displayRegister" [modal]="true" [breakpoints]="{'960px': '75vw'}" [style]="{width: '35vw'}" [draggable]="false" [resizable]="false" styleClass="dialog-delete">
    <div class="row text-center">
        <div class="col-12">
            <h3 class="text-center"><b> {{'register_success' | translate}} </b></h3>
            <p>{{'description_register_success' | translate}}</p>
        </div>
        <div class="col-12">
            <img src="assets/images/check.png" class="mx-auto d-block" alt="">
        </div>
        <div class="col-12 pt-4">
            <button class="btn btn-pf-primary p-btn" (click)="displayRegister=false"> {{'accept' | translate}} </button>
        </div>
    </div>

</p-dialog>